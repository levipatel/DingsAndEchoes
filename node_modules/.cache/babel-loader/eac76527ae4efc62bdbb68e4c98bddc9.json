{"ast":null,"code":"import { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nimport { interceptConnections } from '../helpers/intercept-connections';\nexport const createNativeConvolverNodeFakerFactory = (createNativeAudioNode, createNativeGainNode, monitorConnections) => {\n  return (nativeContext, {\n    buffer,\n    channelCount,\n    channelCountMode,\n    channelInterpretation,\n    disableNormalization\n  }) => {\n    const convolverNode = createNativeAudioNode(nativeContext, ntvCntxt => ntvCntxt.createConvolver());\n    assignNativeAudioNodeOptions(convolverNode, {\n      // Bug #166: Opera does not allow yet to set the channelCount to 1.\n      channelCount: Math.max(channelCount, 2),\n      // Bug #167: Opera does not allow yet to set the channelCountMode to 'explicit'.\n      channelCountMode: channelCountMode === 'max' ? channelCountMode : 'clamped-max',\n      channelInterpretation\n    });\n    const gainNode = createNativeGainNode(nativeContext, {\n      channelCount,\n      channelCountMode,\n      channelInterpretation,\n      gain: 1\n    });\n    const nativeConvolverNodeFaker = {\n      get buffer() {\n        return convolverNode.buffer;\n      },\n\n      set buffer(value) {\n        convolverNode.buffer = value;\n      },\n\n      get bufferSize() {\n        return undefined;\n      },\n\n      get channelCount() {\n        return gainNode.channelCount;\n      },\n\n      set channelCount(value) {\n        // Bug #166: Opera does not allow yet to set the channelCount to 1.\n        if (value > 2) {\n          convolverNode.channelCount = value;\n        }\n\n        gainNode.channelCount = value;\n      },\n\n      get channelCountMode() {\n        return gainNode.channelCountMode;\n      },\n\n      set channelCountMode(value) {\n        // Bug #167: Opera does not allow yet to set the channelCountMode to 'explicit'.\n        if (value === 'max') {\n          convolverNode.channelCountMode = value;\n        }\n\n        gainNode.channelCountMode = value;\n      },\n\n      get channelInterpretation() {\n        return convolverNode.channelInterpretation;\n      },\n\n      set channelInterpretation(value) {\n        convolverNode.channelInterpretation = value;\n        gainNode.channelInterpretation = value;\n      },\n\n      get context() {\n        return convolverNode.context;\n      },\n\n      get inputs() {\n        return [convolverNode];\n      },\n\n      get numberOfInputs() {\n        return convolverNode.numberOfInputs;\n      },\n\n      get numberOfOutputs() {\n        return convolverNode.numberOfOutputs;\n      },\n\n      get normalize() {\n        return convolverNode.normalize;\n      },\n\n      set normalize(value) {\n        convolverNode.normalize = value;\n      },\n\n      addEventListener(...args) {\n        return convolverNode.addEventListener(args[0], args[1], args[2]);\n      },\n\n      dispatchEvent(...args) {\n        return convolverNode.dispatchEvent(args[0]);\n      },\n\n      removeEventListener(...args) {\n        return convolverNode.removeEventListener(args[0], args[1], args[2]);\n      }\n\n    }; // The normalize property needs to be set before setting the buffer.\n\n    if (disableNormalization === nativeConvolverNodeFaker.normalize) {\n      nativeConvolverNodeFaker.normalize = !disableNormalization;\n    }\n\n    if (buffer !== nativeConvolverNodeFaker.buffer) {\n      nativeConvolverNodeFaker.buffer = buffer;\n    }\n\n    const whenConnected = () => convolverNode.connect(gainNode);\n\n    const whenDisconnected = () => convolverNode.disconnect(gainNode);\n\n    return monitorConnections(interceptConnections(nativeConvolverNodeFaker, gainNode), whenConnected, whenDisconnected);\n  };\n};","map":{"version":3,"sources":["../../../src/factories/native-convolver-node-faker-factory.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nimport { interceptConnections } from '../helpers/intercept-connections';\nexport const createNativeConvolverNodeFakerFactory = (createNativeAudioNode, createNativeGainNode, monitorConnections) => {\n    return (nativeContext, { buffer, channelCount, channelCountMode, channelInterpretation, disableNormalization }) => {\n        const convolverNode = createNativeAudioNode(nativeContext, (ntvCntxt) => ntvCntxt.createConvolver());\n        assignNativeAudioNodeOptions(convolverNode, {\n            // Bug #166: Opera does not allow yet to set the channelCount to 1.\n            channelCount: Math.max(channelCount, 2),\n            // Bug #167: Opera does not allow yet to set the channelCountMode to 'explicit'.\n            channelCountMode: channelCountMode === 'max' ? channelCountMode : 'clamped-max',\n            channelInterpretation\n        });\n        const gainNode = createNativeGainNode(nativeContext, { channelCount, channelCountMode, channelInterpretation, gain: 1 });\n        const nativeConvolverNodeFaker = {\n            get buffer() {\n                return convolverNode.buffer;\n            },\n            set buffer(value) {\n                convolverNode.buffer = value;\n            },\n            get bufferSize() {\n                return undefined;\n            },\n            get channelCount() {\n                return gainNode.channelCount;\n            },\n            set channelCount(value) {\n                // Bug #166: Opera does not allow yet to set the channelCount to 1.\n                if (value > 2) {\n                    convolverNode.channelCount = value;\n                }\n                gainNode.channelCount = value;\n            },\n            get channelCountMode() {\n                return gainNode.channelCountMode;\n            },\n            set channelCountMode(value) {\n                // Bug #167: Opera does not allow yet to set the channelCountMode to 'explicit'.\n                if (value === 'max') {\n                    convolverNode.channelCountMode = value;\n                }\n                gainNode.channelCountMode = value;\n            },\n            get channelInterpretation() {\n                return convolverNode.channelInterpretation;\n            },\n            set channelInterpretation(value) {\n                convolverNode.channelInterpretation = value;\n                gainNode.channelInterpretation = value;\n            },\n            get context() {\n                return convolverNode.context;\n            },\n            get inputs() {\n                return [convolverNode];\n            },\n            get numberOfInputs() {\n                return convolverNode.numberOfInputs;\n            },\n            get numberOfOutputs() {\n                return convolverNode.numberOfOutputs;\n            },\n            get normalize() {\n                return convolverNode.normalize;\n            },\n            set normalize(value) {\n                convolverNode.normalize = value;\n            },\n            addEventListener(...args) {\n                return convolverNode.addEventListener(args[0], args[1], args[2]);\n            },\n            dispatchEvent(...args) {\n                return convolverNode.dispatchEvent(args[0]);\n            },\n            removeEventListener(...args) {\n                return convolverNode.removeEventListener(args[0], args[1], args[2]);\n            }\n        };\n        // The normalize property needs to be set before setting the buffer.\n        if (disableNormalization === nativeConvolverNodeFaker.normalize) {\n            nativeConvolverNodeFaker.normalize = !disableNormalization;\n        }\n        if (buffer !== nativeConvolverNodeFaker.buffer) {\n            nativeConvolverNodeFaker.buffer = buffer;\n        }\n        const whenConnected = () => convolverNode.connect(gainNode);\n        const whenDisconnected = () => convolverNode.disconnect(gainNode);\n        return monitorConnections(interceptConnections(nativeConvolverNodeFaker, gainNode), whenConnected, whenDisconnected);\n    };\n};\n//# sourceMappingURL=native-convolver-node-faker-factory.js.map"]},"metadata":{},"sourceType":"module"}